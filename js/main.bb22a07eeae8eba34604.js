webpackJsonp([1],{"./src/components/camera/camera.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/tslib/tslib.es6.js"),s=n("./node_modules/react/index.js"),o=function(e){function t(t){var n=e.call(this,t)||this;return n.state={displayBtn:!1},n.onCameraClick=n.onCameraClick.bind(n),n.onUpload=n.onUpload.bind(n),n.handleSuccess=n.handleSuccess.bind(n),console.log("storage = ",n.props.storage),n}return r.__extends(t,e),t.prototype.handleSuccess=function(e){console.log("success",e),console.log("_video",this._video),console.log(this._video.constructor.name),this._video.srcObject=e,this.setState({displayBtn:!0})},t.prototype.handleError=function(e){console.error("error",e)},t.prototype.onCameraClick=function(e){if(this.hasGetUserMedia()){var t={video:{width:{min:1280},height:{min:720}}};navigator.mediaDevices.getUserMedia(t).then(this.handleSuccess).catch(this.handleError)}else console.error("getUserMedia() is not supported by your browser")},t.prototype.onUpload=function(e){this._canvas.width=this._video.videoWidth,this._canvas.height=this._video.videoHeight,this._canvas.getContext("2d").drawImage(this._video,0,0);var t=this.props.storage.ref(),n=t.child("photos/samle.png"),r=this._canvas.toDataURL("image/png");n.putString(r,"data_url").then(function(e){console.log("Uploaded a data_url string!",e)}).catch(function(e){console.error("Couldnt upload image",e)})},t.prototype.hasGetUserMedia=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},t.prototype.render=function(){var e=this;return s.createElement("div",{className:"camera"},s.createElement("button",{id:"camera",onClick:this.onCameraClick}),s.createElement("label",{htmlFor:"camera"},"Click the camera icon!"),s.createElement("video",{autoPlay:!0,ref:function(t){e._video=t}}),s.createElement("canvas",{ref:function(t){e._canvas=t}}),s.createElement("button",{id:"capture-button",className:this.state.displayBtn?"display":"",onClick:this.onUpload},"Capture"))},t}(s.Component);t.default=o},"./src/components/content-area/content-area.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/tslib/tslib.es6.js"),s=n("./node_modules/react/index.js"),o=n("./src/components/camera/camera.tsx"),a=n("./node_modules/react-router/es/index.js"),i=n("./src/components/login/login.tsx"),l=n("./src/components/file/file.tsx"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this;return s.createElement("article",null,s.createElement(a.Switch,null,s.createElement(a.Route,{exact:!0,path:"/",render:function(){return s.createElement(i.default,{firebase:e.props.firebase})}}),s.createElement(a.Route,{exact:!0,path:"/camera",render:function(){return s.createElement(o.default,{storage:e.props.firebase.storage()})}}),s.createElement(a.Route,{exact:!0,path:"/file",render:function(){return s.createElement(l.default,{firebase:e.props.firebase})}})))},t}(s.Component);t.default=c},"./src/components/file/file.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/tslib/tslib.es6.js"),s=n("./node_modules/react/index.js"),o=n("./src/model/upload.ts"),a=n("./src/model/appuser.ts"),i=n("./src/components/snackbar/snackbar.tsx"),l=n("./node_modules/uuid/v1.js"),c=function(e){function t(t){var n=e.call(this,t)||this;return n.fileReader=new FileReader,n.state={displayUpload:!1,uploadResult:"",errorVisible:!1,errorMsg:""},n.onFileChosen=n.onFileChosen.bind(n),n.onUpload=n.onUpload.bind(n),n.currentUser=new a.AppUser("",""),n.props.firebase.auth().onAuthStateChanged(function(e){if(e){var t=null!=e.email?e.email:"";n.currentUser=new a.AppUser(e.uid,t)}}),n}return r.__extends(t,e),t.prototype.onFileChosen=function(e){var t=this;this.fileReader.readAsDataURL(this._fileField.files[0]),this.fileReader.onload=function(e){t._previewField.src=e.target.result},this.setState({displayUpload:!0})},t.prototype.onUpload=function(e){var t=this;this.fileReader.readAsDataURL(this._fileField.files[0]),this.fileReader.onload=function(e){t.props.firebase.storage().ref().child("photos/"+l()+".jpg").putString(e.target.result,"data_url").then(function(e){var n=new o.Upload(e.metadata.downloadURLs[0],t.currentUser.getUid(),t.currentUser.getEmail());t.writeUploadToDatabase(n),t.setState({uploadResult:"Image successfully uploaded!"})}).catch(function(e){console.error("Upload failed",e),t.setState({uploadResult:"Upload failed",errorVisible:!0,errorMsg:e.message})})}},t.prototype.writeUploadToDatabase=function(e){var t=this,n=this.props.firebase.firestore(),r=n.collection("uploads").doc().id;n.collection("uploads").doc(r).set(e.toObject()).then(function(){console.log("Document successfully written!")}).catch(function(e){console.error("Error writing document: ",e),t.setState({errorVisible:!0,errorMsg:e.toString()})}),n.collection("user-uploads").doc(e.getUid()).set(e.toObject())},t.prototype.render=function(){var e=this;return s.createElement("div",{className:"file"},s.createElement("input",{type:"file",accept:"image/*",id:"capture",className:"captureInput",ref:function(t){e._fileField=t},onChange:this.onFileChosen}),s.createElement("label",{htmlFor:"capture",id:"capture-label"}),s.createElement("img",{ref:function(t){e._previewField=t}}),s.createElement("button",{className:this.state.displayUpload?"btn--raised btn--accent display":"btn--raised btn--accent",onClick:this.onUpload},"Upload"),s.createElement("p",null,this.state.uploadResult),s.createElement(i.default,{visible:this.state.errorVisible,message:this.state.errorMsg}))},t}(s.Component);t.default=c},"./src/components/firephoto-app.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/tslib/tslib.es6.js"),s=n("./node_modules/react/index.js"),o=n("./src/components/header/header.tsx"),a=n("./src/components/content-area/content-area.tsx"),i=n("./node_modules/react-router/es/index.js"),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return s.createElement("div",null,s.createElement(i.Route,{render:function(e){return s.createElement(o.default,{title:t.TITLE})}}),s.createElement(a.default,{firebase:this.props.firebase}))},t.TITLE="FirePhoto",t}(s.Component);t.default=l},"./src/components/header/header.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/tslib/tslib.es6.js"),s=n("./node_modules/react/index.js"),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return s.createElement("header",null,s.createElement("h1",null,this.props.title))},t}(s.Component);t.default=o},"./src/components/login/login.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/tslib/tslib.es6.js"),s=n("./node_modules/react/index.js"),o=n("./src/components/snackbar/snackbar.tsx"),a=function(e){function t(t){var n=e.call(this,t)||this;return n.state={email:"",password:"",errorVisible:!1,errorMsg:""},n.onSignInClick=n.onSignInClick.bind(n),n}return r.__extends(t,e),t.prototype.onSignInClick=function(e){var t=this;console.log("onSignInClick",this.state.email),console.log("onSignInClick",this.state.password),this.props.firebase.auth().signInWithEmailAndPassword(this.state.email,this.state.password).then(function(e){console.log("Logged in = ",e),window.location.replace("/firephoto/#/file")}).catch(function(e){console.error("Error = ",e),t.setState({errorVisible:!0,errorMsg:"Login failed!"})})},t.prototype.updateEmail=function(e){this.setState({email:e.target.value})},t.prototype.updatePwd=function(e){this.setState({password:e.target.value})},t.prototype.render=function(){var e=this;return s.createElement("div",{className:"login"},s.createElement("h1",null,"Login"),s.createElement("div",null,s.createElement("label",{htmlFor:"email"},"Email"),s.createElement("input",{type:"email",name:"email",placeholder:"Email",required:!0,value:this.state.email,onChange:function(t){return e.updateEmail(t)}})),s.createElement("div",null,s.createElement("label",{htmlFor:"password"},"Password"),s.createElement("input",{type:"password",name:"password",placeholder:"Password",required:!0,value:this.state.password,onChange:function(t){return e.updatePwd(t)}})),s.createElement("button",{className:"btn--raised btn--accent",onClick:this.onSignInClick},"Sign in"),s.createElement(o.default,{visible:this.state.errorVisible,message:this.state.errorMsg}))},t}(s.Component);t.default=a},"./src/components/snackbar/snackbar.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/tslib/tslib.es6.js"),s=n("./node_modules/react/index.js"),o=function(e){function t(t){var n=e.call(this,t)||this;return n.state={visible:n.props.visible},n}return r.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){var t=this;e.visible?(this.setState({visible:!0}),setTimeout(function(){t.setState({visible:!1})},3e3)):this.setState({visible:!1})},t.prototype.render=function(){return s.createElement("div",{id:"snackbar",className:this.state.visible?"show":""},this.props.message)},t}(s.Component);t.default=o},"./src/main.tsx":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/react/index.js"),s=n("./node_modules/react-dom/index.js"),o=n("./node_modules/firebase/index.js"),a=n("./src/components/firephoto-app.tsx"),i=n("./node_modules/react-router-dom/es/index.js");n("./node_modules/firebase/firestore/index.js"),n("./src/sass/main.scss"),"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js");var l={apiKey:"AIzaSyC1SGjQtkb1Jscf59qRM6PMlm9vB254qJk",authDomain:"realtime-a0da4.firebaseapp.com",databaseURL:"https://realtime-a0da4.firebaseio.com",projectId:"realtime-a0da4",storageBucket:"realtime-a0da4.appspot.com",messagingSenderId:"558844606511"},c=o.initializeApp(l,"firephoto");s.render(r.createElement(i.HashRouter,null,r.createElement(a.default,{firebase:c})),document.getElementById("app-main"))},"./src/model/appuser.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.uid=e,this.email=t}return e.prototype.getUid=function(){return this.uid},e.prototype.getEmail=function(){return this.email},e}();t.AppUser=r},"./src/model/upload.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.createdAt=(new Date).getTime(),this.starCount=0,this.start=[],this.dUrl=e,this.uid=t,this.nickname=n}return e.prototype.getUid=function(){return this.uid},e.prototype.toObject=function(){return{dUrl:this.dUrl,uid:this.uid,nickname:this.nickname,createdAt:this.createdAt,starCount:this.starCount,start:this.start}},e}();t.Upload=r},"./src/sass/main.scss":function(e,t){}},["./src/main.tsx"]);